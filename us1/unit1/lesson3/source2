<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>John Smith Description</title>
<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background-color: #f7f9fc;
    color: #2c3e50;
    line-height: 1.6;
}

/* Buttons */
button {
    margin: 10px 0 20px 0;
    padding: 8px 12px;
    background-color: #2563eb;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover { background-color: #1d4ed8; }

/* User highlights */
.user-highlight {
    background-color: #fde68a;
    cursor: pointer;
    position: relative;
}

/* Highlight toolbar */
.highlight-toolbar {
    position: absolute;
    top: -25px;
    right: 0;
    background: #1e3a8a;
    color: white;
    padding: 2px 5px;
    border-radius: 4px;
    font-size: 0.8rem;
    display: flex;
    gap: 5px;
    z-index: 20;
}

.highlight-toolbar span {
    cursor: pointer;
}

/* Tooltip words */
.tooltip-word {
    position: relative;
    font-weight: bold;
    cursor: help;
    text-decoration: underline;
    color: #1e3a8a;
}

.tooltip-word .tooltip {
    visibility: hidden;
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #1e3a8a;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    white-space: normal;
    font-size: 0.9rem;
    z-index: 10;
    min-width: 200px;
    max-width: 90%;
    word-wrap: break-word;
}

.tooltip-word:hover .tooltip {
    visibility: visible;
}
</style>
</head>
<body>

<button id="highlightBtn">Highlight Selection</button>
<button id="clearBtn">Clear Highlights</button>

<p id="content">
Each family has its own <span class="tooltip-word">land<span class="tooltip">Plots where families grow crops and raise animals.</span></span> and <span class="tooltip-word">gardens<span class="tooltip">Areas where they plant vegetables and herbs for food.</span></span>. They do their own work. For clothes they wear <span class="tooltip-word">animal skins<span class="tooltip">Furs or hides used to make clothing and keep warm.</span></span>. In winter they wear skins with the fur and hair left on... They build their <span class="tooltip-word">homes<span class="tooltip">Structures where families live, usually made of branches and bark.</span></span> near <span class="tooltip-word">rivers<span class="tooltip">Flowing bodies of water.</span></span> or <span class="tooltip-word">springs<span class="tooltip">Natural sources of fresh water.</span></span>. They tie long <span class="tooltip-word">slender<span class="tooltip">Thin and long in shape.</span></span> branches together in <span class="tooltip-word">bundles<span class="tooltip">Groups of items tied together.</span></span> and <span class="tooltip-word">weaves<span class="tooltip">Interlaces materials together to form fabric or structures.</span></span> them into a frame for the house, like a giant basket... The houses are warm and snug... Their houses are surrounded by their own <span class="tooltip-word">fields<span class="tooltip">Open land used to plant crops or raise animals.</span></span> and gardens. This farmland can be a small plot or large fields... Near their homes are piles of <span class="tooltip-word">wood<span class="tooltip">Logs and branches used for firewood.</span></span> for burning in their home fires... Women have <span class="tooltip-word">babies<span class="tooltip">Infants cared for by their mothers and families.</span></span> easily, and love them very much. To make babies strong, on the coldest mornings they wash them in rivers. They also put oils and lotions on the skin of babies to protect them against the weather. Men <span class="tooltip-word">fish<span class="tooltip">Catch fish for food using nets, traps, or rods.</span></span>, hunt, and go to war. Women often work while the men are <span class="tooltip-word">idle<span class="tooltip">Not working or being inactive.</span></span>. Women and children do all the work. They make <span class="tooltip-word">mats<span class="tooltip">Flat pieces woven from reeds or grasses for sitting or sleeping.</span></span>, <span class="tooltip-word">baskets<span class="tooltip">Containers woven from plant fibers to carry or store items.</span></span>, pots, and grinding tools, grind corn into flour, bake bread, and do all the cooking. They also do the farming, planting, raising, and gathering of corn. Women do the <span class="tooltip-word">hauling<span class="tooltip">Carrying or moving heavy loads.</span></span> and all the other heavy work... They use <span class="tooltip-word">boats<span class="tooltip">Watercraft used for travel or fishing on rivers and lakes.</span></span> for fishing...
<br><br>
John Smith's Description of the Powhatans, 1612.
</p>

<script>
// Highlight selected text
document.getElementById('highlightBtn').addEventListener('click', () => {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const range = selection.getRangeAt(0);
    if (range.collapsed) return;

    // Prevent highlighting inside tooltip words
    let ancestor = range.commonAncestorContainer;
    while (ancestor && ancestor !== document.body) {
        if (ancestor.classList && ancestor.classList.contains('tooltip-word')) return;
        ancestor = ancestor.parentNode;
    }

    const span = document.createElement('span');
    span.className = 'user-highlight';
    
    const extracted = range.extractContents();
    span.appendChild(extracted);

    // Highlight toolbar
    span.addEventListener('click', (e) => {
        e.stopPropagation();
        removeExistingToolbars();
        const toolbar = document.createElement('div');
        toolbar.className = 'highlight-toolbar';
        toolbar.innerHTML = '<span class="remove">❌</span><span class="copy">©</span>';

        toolbar.querySelector('.remove').addEventListener('click', () => {
            span.replaceWith(...span.childNodes);
        });
        toolbar.querySelector('.copy').addEventListener('click', () => {
            navigator.clipboard.writeText(span.textContent);
        });

        span.appendChild(toolbar);
    });

    range.insertNode(span);
    selection.removeAllRanges();
});

// Remove toolbars
document.addEventListener('click', () => {
    document.querySelectorAll('.highlight-toolbar').forEach(t => t.remove());
});

// Clear highlights but keep tooltips
document.getElementById('clearBtn').addEventListener('click', () => {
    const content = document.getElementById('content');
    const cloned = content.cloneNode(true);
    cloned.querySelectorAll('span.user-highlight').forEach(span => {
        span.replaceWith(...span.childNodes);
    });
    content.innerHTML = cloned.innerHTML;
});

// Tooltip viewport adjustment
document.querySelectorAll('.tooltip-word').forEach(word => {
    word.addEventListener('mouseenter', () => {
        const tooltip = word.querySelector('.tooltip');
        const rect = tooltip.getBoundingClientRect();
        const padding = 10;

        if (rect.right > window.innerWidth - padding) {
            tooltip.style.left = 'auto';
            tooltip.style.right = '0';
            tooltip.style.transform = 'none';
        }
        if (rect.left < padding) {
            tooltip.style.left = '0';
            tooltip.style.right = 'auto';
            tooltip.style.transform = 'none';
        }
    });

    word.addEventListener('mouseleave', () => {
        const tooltip = word.querySelector('.tooltip');
        tooltip.style.left = '50%';
        tooltip.style.right = 'auto';
        tooltip.style.transform = 'translateX(-50%)';
    });
});
</script>

</body>
</html>
