<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Governor's Letter</title>
<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background-color: #f7f9fc;
    color: #2c3e50;
    line-height: 1.6;
}

/* Buttons */
button {
    margin: 10px 0 20px 0;
    padding: 8px 12px;
    background-color: #2563eb;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover { background-color: #1d4ed8; }

/* User highlights */
.user-highlight {
    background-color: #fde68a;
    cursor: pointer;
    position: relative;
}

/* Highlight toolbar */
.highlight-toolbar {
    position: absolute;
    top: -25px;
    right: 0;
    background: #1e3a8a;
    color: white;
    padding: 2px 5px;
    border-radius: 4px;
    font-size: 0.8rem;
    display: flex;
    gap: 5px;
    z-index: 20;
}

.highlight-toolbar span {
    cursor: pointer;
}

/* Tooltip words */
.tooltip-word {
    position: relative;
    font-weight: bold;
    cursor: help;
    text-decoration: underline;
    color: #1e3a8a;
}

.tooltip-word .tooltip {
    visibility: hidden;
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #1e3a8a;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    white-space: normal;
    font-size: 0.9rem;
    z-index: 10;
    min-width: 200px;
    max-width: 90%;
    word-wrap: break-word;
}

.tooltip-word:hover .tooltip {
    visibility: visible;
}
</style>
</head>
<body>

<button id="highlightBtn">Highlight Selection</button>
<button id="clearBtn">Clear Highlights</button>

<p id="content">
Dear <span class="tooltip-word">Sirs<span class="tooltip">Formal salutation used in letters to officials or superiors.</span></span>,<br><br>

We welcome the increase of new <span class="tooltip-word">settlers<span class="tooltip">People moving to a new land to live and work there.</span></span> to our land. There is much to do, and we need hardworking <span class="tooltip-word">men<span class="tooltip">Adult males capable of labor.</span></span> of strong <span class="tooltip-word">body<span class="tooltip">Physically fit individuals for labor and defense.</span></span> and <span class="tooltip-word">character<span class="tooltip">Moral qualities or reputation.</span></span>. However, I request that you decrease the number of <span class="tooltip-word">passengers<span class="tooltip">People traveling on a ship.</span></span> in favor of carrying increased amounts of <span class="tooltip-word">food supplies<span class="tooltip">Provisions for the settlers, including grains, meat, and other necessities.</span></span>.<br><br>

Respectfully,<br><br>

<span class="tooltip-word">Governor Samuel Argall<span class="tooltip">The Governor of the Virginia Colony during the early 1600s.</span></span><br>
Letter from Governor of Virginia Colony to Virginia Company in London
</p>

<script>
// Highlight selected text
document.getElementById('highlightBtn').addEventListener('click', () => {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const range = selection.getRangeAt(0);
    if (range.collapsed) return;

    // Prevent highlighting inside tooltip words
    let ancestor = range.commonAncestorContainer;
    while (ancestor && ancestor !== document.body) {
        if (ancestor.classList && ancestor.classList.contains('tooltip-word')) return;
        ancestor = ancestor.parentNode;
    }

    const span = document.createElement('span');
    span.className = 'user-highlight';
    
    const extracted = range.extractContents();
    span.appendChild(extracted);

    // Highlight toolbar
    span.addEventListener('click', (e) => {
        e.stopPropagation();
        removeExistingToolbars();
        const toolbar = document.createElement('div');
        toolbar.className = 'highlight-toolbar';
        toolbar.innerHTML = '<span class="remove">❌</span><span class="copy">©</span>';

        toolbar.querySelector('.remove').addEventListener('click', () => {
            span.replaceWith(...span.childNodes);
        });
        toolbar.querySelector('.copy').addEventListener('click', () => {
            navigator.clipboard.writeText(span.textContent);
        });

        span.appendChild(toolbar);
    });

    range.insertNode(span);
    selection.removeAllRanges();
});

// Remove toolbars
document.addEventListener('click', () => {
    document.querySelectorAll('.highlight-toolbar').forEach(t => t.remove());
});

// Clear highlights but keep tooltips
document.getElementById('clearBtn').addEventListener('click', () => {
    const content = document.getElementById('content');
    const cloned = content.cloneNode(true);
    cloned.querySelectorAll('span.user-highlight').forEach(span => {
        span.replaceWith(...span.childNodes);
    });
    content.innerHTML = cloned.innerHTML;
});

// Tooltip viewport adjustment
document.querySelectorAll('.tooltip-word').forEach(word => {
    word.addEventListener('mouseenter', () => {
        const tooltip = word.querySelector('.tooltip');
        const rect = tooltip.getBoundingClientRect();
        const padding = 10;

        if (rect.right > window.innerWidth - padding) {
            tooltip.style.left = 'auto';
            tooltip.style.right = '0';
            tooltip.style.transform = 'none';
        }
        if (rect.left < padding) {
            tooltip.style.left = '0';
            tooltip.style.right = 'auto';
            tooltip.style.transform = 'translateX(0)';
        }
    });

    word.addEventListener('mouseleave', () => {
        const tooltip = word.querySelector('.tooltip');
        tooltip.style.left = '50%';
        tooltip.style.right = 'auto';
        tooltip.style.transform = 'translateX(-50%)';
    });
});
</script>

</body>
</html>
